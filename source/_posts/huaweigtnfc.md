---
title: 华为GT2 Pro ECG写入NFC门禁卡记录
date: 2023-02-21 09:54:55
tags:
- R3300-M
- Manjaro ARM
- dhcpcd
index_img: /img/gt2pro.jpg
---
# 设备
1. Huawei Watch GT 2 Pro ECG，准备写入NFC数据的对象；
2. vivo iQOO Neo 7，原门禁卡信息储存在此手机中，计划转移到手表上；
3. 小米10手机，用来模拟加密NFC卡的卡号，供手表模拟出卡号一致的卡片；
4. Proxmark3设备一台，购于苏州龙达科技淘宝店。

# 软件
1. Proxmark3软件，由店铺提供。店铺定制的软件主要对常用命令进行了封装，用起来比较便利，缺点绑定电脑；
2. 华为运动健康app，安装于vivo iQOO Neo 7。

# 破解原NFC卡片
1. vivo iQOO Neo 7中打开关机刷卡功能，并选中欲破解的NFC卡片；
2. Neo 7关机；
3. Neo 7放在Proxmark3设备感应区，进行解析。快速解析后还有2个扇区处于加密状态，单独对这两个扇区进行暴力破解，用i3-8100配置的电脑破解约耗时30分钟。破解结束后点击 **读S50** 然后保存明文数据备用。

# 手表写卡
1. Neo 7开机，在华为健康app中选择模拟门禁卡。用小米10手机模拟vivo iQOO Neo 7门禁卡的卡号，然后用手表对小米10进行模拟。注意不要给手表下发空白卡，否则卡号改不过来；
2. 手表放在Proxmark3感应区，选择 **S50写卡** ，首次写入后中间8个扇区数据提示写入失败，使用 **S50密写** 功能再写一次就成功了。个别内容全为0的扇区如果提示写入失败也无妨，NFC卡片默认扇区数据本来就是用0充填的，可以读取手表数据核实。

# 试验
用手表测试小区大门、单元楼门、电梯成功。注意 **手表测试成功后一定要第一时间删掉手机中的卡片** ，现在电梯梯控普遍使用了滚动码，被发现复制卡后会即时拉黑。

# 关于在手表上使用百度地图和高德地图
手机客户端必须从华为应用商店下载，否则无法连接手表使用。

# 关于GPS定位速度、精度
通过蓝牙连接手机时，手表默认使用手机定位。独立定位一般不超过30秒，精度不及手机，会有些许漂移。

# 下步计划
分析数据对电梯卡延期，给物业减轻工作负担。

# 更新
成功实现电梯卡延期，直接一步到位续到了2099年1月1日 。。。 方法其实很简单，用客服提供的软件对dump文件进行数据分析，可知梯控采用了 **大华1系统** ，日期对应位置为10区1块6-8，数据为 **17071F** 。这个值没有做校验，直接修改即可。需要解决的第二个问题是日期转换，如何将 **2099年1月1日** 转换为电梯能识别的6位编码呢？ 在软件中利用日期反查功能查询  **17071F** ，软件会以各种常见算法进行推算，得到了 **2031年7月23日** 和 **2023年7月31日** 两个有效日期，很显然 **2023年7月31日** 对应正确算法。利用这个算法对 **2099年1月1日** 进行转换，得到 **630101** ，写卡后顺利完成测试。唯一的问题是，我活不到2099年了 😭😭😭